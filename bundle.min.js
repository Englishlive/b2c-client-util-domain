!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.bundle=b()}(this,function(){var a=function(){"use strict";function a(){var a=this;if(a.promise.result=arguments[0],!a.promise[h]&&!a.promise[i]){a.promise[h]=!0;for(var b=0;b<a.promise._s.length;b++)a.promise._s[b].call(null,a.promise.result);a.promise._s=[]}}function b(){var a=this;if(a.promise.error=arguments[0],!a.promise[h]&&!a.promise[i]){a.promise[i]=!0;for(var b=0;b<a.promise._f.length;b++)a.promise._f[b].call(null,a.promise.error);a.promise._f=[]}}function c(e){if(!(this instanceof c))return new c(e);var f=this;f.promise=e&&"then"in e?e:new d(f),f.resolve=function(){return a.apply(f,arguments)},f.reject=function(){return b.apply(f,arguments)}}function d(a){if(this._s=[],this._f=[],this._defer=a&&a instanceof c?a:new c(this),this.result=null,this.error=null,typeof a===g)try{a.call(this,this._defer.resolve,this._defer.reject)}catch(b){this._defer.reject(b)}}function e(a,b){var c=this;return function(){var d=a.apply(c,arguments);d&&typeof d.then===g?d.then(function(){b.resolve.apply(b,arguments)},function(){b.reject.apply(b,arguments)}):b.resolve.apply(b,null==d?[]:[d])}}var f="prototype",g="function",h="resolved",i="rejected";return d[f].then=function(a,b){var d,f,j=new c,k=this;return d=typeof a==g?e.call(k,a,j):j.resolve,k[h]?d.call(null,k.result):k._s.push(d),f=typeof b==g?e.call(k,b,j):j.reject,k[i]?f.call(null,k.error):k._f.push(f),j.promise},c.Promise=d,c.resolve=function(a){var b=new c;return b.resolve(a),b.promise},c.reject=function(a){var b=new c;return b.reject(a),b.promise},c.all=function(a){return new d(function(b,c){function d(a){g.push(a),f++,e===f&&b(g)}for(var e=a.length,f=0,g=[],h=a.length;h--;)"then"in a[h]?a[h].then(d,c):e--;return 0>=e?void b():void 0})},c}(),b=function(a){"use strict";return window.Promise||a.Promise}(a),c=function(a){"use strict";function b(a,b){if("function"==typeof a.indexOf)return a.indexOf(b)>=0;for(var c=0;c<a.length;c++)return a[c]===b?!0:!1}function c(b){return new a(function(a){a(b)})}function d(b){return new a(function(a,c){c(b)})}function e(a){for(var b,c=n.length;c--;)if(b=n[c],b.code==a)return b.domain;return f.ENGLISHLIVE}function f(a){if(null==a)throw new Error("domain must be specified");this.domain=a.toLowerCase(),this.is=new i(this),this.get=new h(this),this.set=new g(this)}function g(a){this._context=a}function h(a){this._context=a}function i(a){this._context=a}var j="live",k="qa",l="stg",m="dev";f.ENGLISHLIVE="englishlive.ef.com",f.ENGLISHLIVE_QA="qa-englishlive.ef.com",f.ENGLISHLIVE_STAGING="stg-englishlive.ef.com",f.ENGLISHTOWN="englishtown.com",f.ENGLISHTOWN_SEO="efenglishtown.com",f.ENGLISHTOWN_JP="englishtown.co.jp",f.ENGLISHTOWN_MX="englishtown.com.mx",f.ENGLISHTOWN_RU="englishtown.ru",f.ENGLISHTOWN_BR="englishtown.com.br",f.ENGLISHTOWN_CN="englishtown.cn",f.ENGLISHTOWN_CN_LEGACY="englishtown.com.cn",f.ENGLISHTOWN_FR="englishtown.fr",f.ENGLISHTOWN_DE="englishtown.de",f.ENGLISHTOWN_ES="englishtown.es",f.ENGLISHCENTER="englishcenters.ef.com",f.ENGLISHCENTER_QA="qa-englishcenters.ef.com",f.ENGLISHCENTER_STAGING="stg-englishcenters.ef.com",f.englishLives=[f.ENGLISHLIVE,f.ENGLISHLIVE_QA,f.ENGLISHLIVE_STAGING],f.englishCenters=[f.ENGLISHCENTER,f.ENGLISHCENTER_QA,f.ENGLISHCENTER_STAGING],f.englishTowns=[f.ENGLISHTOWN,f.ENGLISHTOWN_JP,f.ENGLISHTOWN_MX,f.ENGLISHTOWN_RU,f.ENGLISHTOWN_BR,f.ENGLISHTOWN_CN,f.ENGLISHTOWN_CN_LEGACY,f.ENGLISHTOWN_FR,f.ENGLISHTOWN_DE,f.ENGLISHTOWN_ES],f.all=[f.ENGLISHTOWN_SEO].concat(f.englishLives).concat(f.englishTowns).concat(f.englishCenters),f.env={},f.env.LIVE=j,f.env.STAGING=l,f.env.QA=k,f.env.DEV=m;var n=[{code:"br",domain:f.ENGLISHTOWN_BR,brand:"englishtown"}];return f.get={by:function(a){return null==a?d("Option must be specified"):a.market?c(e(a.market)):d("Option is empty or unknown")}},f.config={getMarket:null},f.prototype.toString=function(){return this.domain},g.prototype.env=function(a){var c=this._context.get.topLevel(f.all),d=!1,e=f.ENGLISHLIVE;null!=c&&((c===f.ENGLISHLIVE||c===f.ENGLISHLIVE_QA||c===f.ENGLISHLIVE_STAGING||c===f.ENGLISHCENTER||c===f.ENGLISHCENTER_QA||c===f.ENGLISHCENTER_STAGING)&&(d=!0),d?(b(f.englishCenters,c)&&(e=f.ENGLISHCENTER),a===j?this._context.domain=e:a===l?this._context.domain="stg-"+e:a===k?this._context.domain="qa-"+e:a===m&&(this._context.domain="dev-"+e)):a===j?this._context.domain="www."+c:a===l?this._context.domain="staging."+c:a===k?this._context.domain="qa."+c:a===m&&(this._context.domain="local."+c))},h.prototype.topLevel=function(a){for(var b=null,c=a.length;c--;)if(null!==this.subsOf(a[c])){b=a[c];break}return b},h.prototype.subsOf=function(a){var b,c,d=this._context.domain,e=d.split("."),f=a.split("."),g=0,h=[];for(c=f.length;c--;)if(g=e.length-(f.length-c),f[c]!==e[g]){h=null;break}if(null===h)return h;for(b=0;g>b;b++)h.push(e[b]);return h},h.prototype.env=function(){var a=this.topLevel(f.all);if(null==a)return null;var b=this.subsOf(a);return null==b?null:a===f.ENGLISHLIVE_QA||a===f.ENGLISHCENTER_QA?k:a===f.ENGLISHLIVE_STAGING||a===f.ENGLISHCENTER_STAGING?l:b[0]===k||b[0]==l||b[0]==m?b[0]:"staging"===b[0]?l:"local"===b[0]?m:j},h.prototype.secure=function(){var a=this,b=a._context.is.subOf(f.ENGLISHTOWN_SEO);if(!b)return c(a._context.domain);var d,e=a.env(),g="";return f.config.getMarket().then(function(b){d=b,a._context.is.subOf(f.englishTowns)?e===f.env.LIVE?g="www.":e===f.env.QA?g="qa.":e===f.env.STAGING&&(g="staging."):e===f.env.QA?g="qa-":e===f.env.STAGING&&(g="stg-")}).then(function(){return f.get.by({market:d})}).then(function(a){return c(g+a)})},i.prototype.subOf=function(a){if("object"==typeof a&&"length"in a){for(var b=a.length;b--;)if(this.subOf(a[b]))return!0;return!1}return null!==this._context.get.subsOf(a)?!0:!1},i.prototype.ours=function(){return this.subOf(f.all)},f}(b),d=function(a){"use strict";return{Domain:a}}(c);return d});