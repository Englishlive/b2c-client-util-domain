!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.bundle=b()}(this,function(){var a=function(){"use strict";function a(){var a=this;if(a.promise.result=arguments[0],!a.promise[i]){a.promise[h]=!0;for(var b=0;b<a.promise._s.length;b++)a.promise._s[b].call(null,a.promise.result);a.promise._s=[]}}function b(){var a=this;if(a.promise.error=arguments[0],!a.promise[h]){a.promise[i]=!0;for(var b=0;b<a.promise._f.length;b++)a.promise._f[b].call(null,a.promise.error);a.promise._f=[]}}function c(e){if(!(this instanceof c))return new c(e);var f=this;f.promise=e&&"then"in e?e:new d(f),f.resolve=function(){return a.apply(f,arguments)},f.reject=function(){return b.apply(f,arguments)}}function d(a){if(this._s=[],this._f=[],this._defer=a&&a instanceof c?a:new c(this),this.result=null,this.error=null,typeof a===g)try{a.call(this,this._defer.resolve,this._defer.reject)}catch(b){this._defer.reject(b)}}function e(a,b){var c=this;return function(){var d=a.apply(c,arguments);d&&typeof d.then===g?d.then(function(){b.resolve.apply(b,arguments)},function(){b.reject.apply(b,arguments)}):b.resolve.apply(b,null==d?[]:[d])}}var f="prototype",g="function",h="resolved",i="rejected";return d[f].then=function(a,b){var d,f,j=new c,k=this;return d=typeof a==g?e.call(k,a,j):j.resolve,k[h]?d.call(null,k.result):k._s.push(d),f=typeof b==g?e.call(k,b,j):j.reject,k[i]?f.call(null,k.error):k._f.push(f),j.promise},c.Promise=d,c.resolve=function(){var a=new c;return a.resolve(),a.promise},c.all=function(a){return new d(function(b,c){function d(a){g.push(a),f++,e===f&&b(g)}for(var e=a.length,f=0,g=[],h=a.length;h--;)"then"in a[h]?a[h].then(d,c):e--;return 0>=e?void b():void 0})},c}(),b=function(a){"use strict";function b(a){for(var b,d=k.length;d--;)if(b=k[d],b.code==a)return b.domain;return c.ENGLISHLIVE}function c(a){if(null==a)throw new Error("domain must be specified");this.domain=a.toLowerCase(),this.is=new f(this),this.get=new e(this),this.set=new d(this)}function d(a){this._context=a}function e(a){this._context=a}function f(a){this._context=a}var g="live",h="qa",i="stg",j="dev";c.ENGLISHLIVE="englishlive.ef.com",c.ENGLISHLIVE_QA="qa-englishlive.ef.com",c.ENGLISHLIVE_STAGING="stg-englishlive.ef.com",c.ENGLISHTOWN="englishtown.com",c.ENGLISHTOWN_SEO="efenglishtown.com",c.ENGLISHTOWN_JP="englishtown.co.jp",c.ENGLISHTOWN_MX="englishtown.com.mx",c.ENGLISHTOWN_RU="englishtown.ru",c.ENGLISHTOWN_BR="englishtown.com.br",c.ENGLISHTOWN_CN="englishtown.cn",c.ENGLISHTOWN_CN_LEGACY="englishtown.com.cn",c.ENGLISHTOWN_FR="englishtown.fr",c.ENGLISHTOWN_DE="englishtown.de",c.ENGLISHTOWN_ES="englishtown.es",c.englishLives=[c.ENGLISHTOWN,c.ENGLISHLIVE,c.ENGLISHLIVE_QA,c.ENGLISHLIVE_STAGING],c.englishTowns=[c.ENGLISHTOWN_JP,c.ENGLISHTOWN_MX,c.ENGLISHTOWN_RU,c.ENGLISHTOWN_BR,c.ENGLISHTOWN_CN,c.ENGLISHTOWN_CN_LEGACY,c.ENGLISHTOWN_FR,c.ENGLISHTOWN_DE,c.ENGLISHTOWN_ES],c.all=[c.ENGLISHTOWN_SEO].concat(c.englishLives).concat(c.englishTowns),c.env={},c.env.LIVE=g,c.env.STAGING=i,c.env.QA=h,c.env.DEV=j;var k=[{code:"jp",domain:c.ENGLISHTOWN_JP,brand:"englishtown"},{code:"tw",domain:c.ENGLISHTOWN,brand:"englishtown"}];return c.get={by:function(c){if(null==c){var d=new a;return d.reject("Option must be specified"),d.promise}return c.market?a.resolve(b(c.market)):a.reject("Option is empty or unknown")}},c.config={getMarket:null},c.prototype.toString=function(){return this.domain},d.prototype.env=function(a){var b=this._context.get.topLevel(c.all);null!=b&&(b===c.ENGLISHLIVE||b===c.ENGLISHLIVE_QA||b===c.ENGLISHLIVE_STAGING?a===g?this._context.domain=c.ENGLISHLIVE:a===i?this._context.domain="stg-"+c.ENGLISHLIVE:a===h?this._context.domain="qa-"+c.ENGLISHLIVE:a===j&&(this._context.domain="dev-"+c.ENGLISHLIVE):a===g?this._context.domain="www."+b:a===i?this._context.domain="staging."+b:a===h?this._context.domain="qa."+b:a===j&&(this._context.domain="local."+b))},e.prototype.topLevel=function(a){for(var b=null,c=a.length;c--;)if(null!==this.subsOf(a[c])){b=a[c];break}return b},e.prototype.subsOf=function(a){var b,c,d=this._context.domain,e=d.split("."),f=a.split("."),g=0,h=[];for(c=f.length;c--;)if(g=e.length-(f.length-c),f[c]!==e[g]){h=null;break}if(null===h)return h;for(b=0;g>b;b++)h.push(e[b]);return h},e.prototype.env=function(){var a=this.topLevel(c.all);if(null==a)return null;var b=this.subsOf(a);return null==b?null:a===c.ENGLISHLIVE_QA?h:a===c.ENGLISHLIVE_STAGING?i:b[0]===h||b[0]==i||b[0]==j?b[0]:"staging"===b[0]?i:"local"===b[0]?j:g},e.prototype.secure=function(){var b=this,d=b._context.is.subOf(c.ENGLISHTOWN_SEO);if(!d)return a.resolve(b._context.domain);var e,f=b.env(),g="";return c.config.getMarket().then(function(a){e=a,b._context.is.subOf(c.englishTowns)?f===c.env.LIVE?g="www.":f===c.env.QA?g="qa.":f===c.env.STAGING&&(g="staging."):f===c.env.QA?g="qa-":f===c.env.STAGING&&(g="stg-")}).then(function(){return c.get.by({market:e})}).then(function(b){return a.resolve(g+b)})},f.prototype.subOf=function(a){if("object"==typeof a&&"length"in a){for(var b=a.length;b--;)if(this.subOf(a[b]))return!0;return!1}return null!==this._context.get.subsOf(a)?!0:!1},f.prototype.ours=function(){return this.subOf(c.all)},c}(a),c=function(a){"use strict";return{Domain:a}}(b);return c});