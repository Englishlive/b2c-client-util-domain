!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.bundle=b()}(this,function(){var a=function(){"use strict";function a(){var a=this;if(a.promise.result=arguments[0],!a.promise[h]&&!a.promise[i]){a.promise[h]=!0;for(var b=0;b<a.promise._s.length;b++)a.promise._s[b].call(null,a.promise.result);a.promise._s=[]}}function b(){var a=this;if(a.promise.error=arguments[0],!a.promise[h]&&!a.promise[i]){a.promise[i]=!0;for(var b=0;b<a.promise._f.length;b++)a.promise._f[b].call(null,a.promise.error);a.promise._f=[]}}function c(e){if(!(this instanceof c))return new c(e);var f=this;f.promise=e&&"then"in e?e:new d(f),f.resolve=function(){return a.apply(f,arguments)},f.reject=function(){return b.apply(f,arguments)}}function d(a){if(this._s=[],this._f=[],this._defer=a&&a instanceof c?a:new c(this),this.result=null,this.error=null,typeof a===g)try{a.call(this,this._defer.resolve,this._defer.reject)}catch(b){this._defer.reject(b)}}function e(a,b){var c=this;return function(){var d=a.apply(c,arguments);d&&typeof d.then===g?d.then(function(){b.resolve.apply(b,arguments)},function(){b.reject.apply(b,arguments)}):b.resolve.apply(b,null==d?[]:[d])}}var f="prototype",g="function",h="resolved",i="rejected";return d[f].then=function(a,b){var d,f,j=new c,k=this;return d=typeof a==g?e.call(k,a,j):j.resolve,k[h]?d.call(null,k.result):k._s.push(d),f=typeof b==g?e.call(k,b,j):j.reject,k[i]?f.call(null,k.error):k._f.push(f),j.promise},c.Promise=d,c.resolve=function(a){var b=new c;return b.resolve(a),b.promise},c.reject=function(a){var b=new c;return b.reject(a),b.promise},c.all=function(a){return new d(function(b,c){function d(a){g.push(a),f++,e===f&&b(g)}for(var e=a.length,f=0,g=[],h=a.length;h--;)"then"in a[h]?a[h].then(d,c):e--;return 0>=e?void b():void 0})},c}(),b=function(a){"use strict";return window.Promise||a.Promise}(a),c=function(a){"use strict";function b(b){return new a(function(a){a(b)})}function c(b){return new a(function(a,c){c(b)})}function d(a){for(var b,c=m.length;c--;)if(b=m[c],b.code==a)return b.domain;return e.ENGLISHLIVE}function e(a){if(null==a)throw new Error("domain must be specified");this.domain=a.toLowerCase(),this.is=new h(this),this.get=new g(this),this.set=new f(this)}function f(a){this._context=a}function g(a){this._context=a}function h(a){this._context=a}var i="live",j="qa",k="stg",l="dev";e.ENGLISHLIVE="englishlive.ef.com",e.ENGLISHLIVE_QA="qa-englishlive.ef.com",e.ENGLISHLIVE_STAGING="stg-englishlive.ef.com",e.ENGLISHTOWN="englishtown.com",e.ENGLISHTOWN_SEO="efenglishtown.com",e.ENGLISHTOWN_JP="englishtown.co.jp",e.ENGLISHTOWN_MX="englishtown.com.mx",e.ENGLISHTOWN_RU="englishtown.ru",e.ENGLISHTOWN_BR="englishtown.com.br",e.ENGLISHTOWN_CN="englishtown.cn",e.ENGLISHTOWN_CN_LEGACY="englishtown.com.cn",e.ENGLISHTOWN_FR="englishtown.fr",e.ENGLISHTOWN_DE="englishtown.de",e.ENGLISHTOWN_ES="englishtown.es",e.englishLives=[e.ENGLISHLIVE,e.ENGLISHLIVE_QA,e.ENGLISHLIVE_STAGING],e.englishTowns=[e.ENGLISHTOWN,e.ENGLISHTOWN_JP,e.ENGLISHTOWN_MX,e.ENGLISHTOWN_RU,e.ENGLISHTOWN_BR,e.ENGLISHTOWN_CN,e.ENGLISHTOWN_CN_LEGACY,e.ENGLISHTOWN_FR,e.ENGLISHTOWN_DE,e.ENGLISHTOWN_ES],e.all=[e.ENGLISHTOWN_SEO].concat(e.englishLives).concat(e.englishTowns),e.env={},e.env.LIVE=i,e.env.STAGING=k,e.env.QA=j,e.env.DEV=l;var m=[{code:"br",domain:e.ENGLISHTOWN_BR,brand:"englishtown"}];return e.get={by:function(a){return null==a?c("Option must be specified"):a.market?b(d(a.market)):c("Option is empty or unknown")}},e.config={getMarket:null},e.prototype.toString=function(){return this.domain},f.prototype.env=function(a){var b=this._context.get.topLevel(e.all);null!=b&&(b===e.ENGLISHLIVE||b===e.ENGLISHLIVE_QA||b===e.ENGLISHLIVE_STAGING?a===i?this._context.domain=e.ENGLISHLIVE:a===k?this._context.domain="stg-"+e.ENGLISHLIVE:a===j?this._context.domain="qa-"+e.ENGLISHLIVE:a===l&&(this._context.domain="dev-"+e.ENGLISHLIVE):a===i?this._context.domain="www."+b:a===k?this._context.domain="staging."+b:a===j?this._context.domain="qa."+b:a===l&&(this._context.domain="local."+b))},g.prototype.topLevel=function(a){for(var b=null,c=a.length;c--;)if(null!==this.subsOf(a[c])){b=a[c];break}return b},g.prototype.subsOf=function(a){var b,c,d=this._context.domain,e=d.split("."),f=a.split("."),g=0,h=[];for(c=f.length;c--;)if(g=e.length-(f.length-c),f[c]!==e[g]){h=null;break}if(null===h)return h;for(b=0;g>b;b++)h.push(e[b]);return h},g.prototype.env=function(){var a=this.topLevel(e.all);if(null==a)return null;var b=this.subsOf(a);return null==b?null:a===e.ENGLISHLIVE_QA?j:a===e.ENGLISHLIVE_STAGING?k:b[0]===j||b[0]==k||b[0]==l?b[0]:"staging"===b[0]?k:"local"===b[0]?l:i},g.prototype.secure=function(){var a=this,c=a._context.is.subOf(e.ENGLISHTOWN_SEO);if(!c)return b(a._context.domain);var d,f=a.env(),g="";return e.config.getMarket().then(function(b){d=b,a._context.is.subOf(e.englishTowns)?f===e.env.LIVE?g="www.":f===e.env.QA?g="qa.":f===e.env.STAGING&&(g="staging."):f===e.env.QA?g="qa-":f===e.env.STAGING&&(g="stg-")}).then(function(){return e.get.by({market:d})}).then(function(a){return b(g+a)})},h.prototype.subOf=function(a){if("object"==typeof a&&"length"in a){for(var b=a.length;b--;)if(this.subOf(a[b]))return!0;return!1}return null!==this._context.get.subsOf(a)?!0:!1},h.prototype.ours=function(){return this.subOf(e.all)},e}(b),d=function(a){"use strict";return{Domain:a}}(c);return d});